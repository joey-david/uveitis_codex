input:
  manifests:
    - manifests/fgadr_train700.jsonl
    - manifests/uwf700_labeled.jsonl

output:
  preproc_root: preproc_main9_fastiter
  global_dirname: global

roi:
  method: threshold
  method_by_dataset:
    uwf700: sam2_prompted
  downsample_max_side: 1024
  sat_threshold: 18
  crop_pad_px: 12
  sam2:
    checkpoint: models/sam2/sam2.1_hiera_base_plus.pt
    model_cfg: configs/sam2.1/sam2.1_hiera_b+.yaml
    device: cuda
    fallback_to_threshold: true
    multimask_output: true
    points_norm:
      - [0.50, 0.50, 1]
      - [0.35, 0.50, 1]
      - [0.65, 0.50, 1]
      - [0.50, 0.35, 1]
      - [0.50, 0.65, 1]
      - [0.03, 0.03, 0]
      - [0.97, 0.03, 0]
      - [0.03, 0.97, 0]
      - [0.97, 0.97, 0]
      - [0.50, 0.02, 0]
      - [0.50, 0.98, 0]
    open_kernel: 7
    close_kernel: 19
    min_area_ratio: 0.10
    max_area_ratio: 0.98
    max_border_touch_ratio: 0.55

normalize:
  method: reinhard_lab_ref
  stats_erode_px: 4
  ref:
    stats_path: preproc/ref/regular_fundus_color_stats_50.json

resize:
  global_size: 1024

tiling:
  tile_size: 768
  overlap: 0.25

verify:
  min_roi_area_ratio: 0.12
  montage_n: 20
  reconstruct_n: 20
